ALTER SESSION set"_ORACLE_SCRIPT"=true;
CREATE USER NORM IDENTIFIED BY 1234
DEFAULT TABLESPACE users
TEMPORARY TABLESPACE temp;
-- ---------------------------------------------------------------------
ALTER USER NORM DEFAULT TABLESPACE USERS;
ALTER USER NORM TEMPORARY TABLESPACE temp;
GRANT connect, resource TO NORM;
GRANT INSERT ANY TABLE TO NORM; 
GRANT unlimited tablespace TO NORM;
CONNEC NORM/1234

set linesize 300
set pagesize 90
set colsep 'â•‘'
set null s/Datos

DROP TABLE PEDIDOS_LIBROS CASCADE CONSTRAINTS;
DROP TABLE LIBROS CASCADE CONSTRAINTS;
DROP TABLE PEDIDOS CASCADE CONSTRAINTS;
DROP TABLE AUTORES CASCADE CONSTRAINTS;
DROP TABLE PROVEEDORES CASCADE CONSTRAINTS;

CREATE TABLE PROVEEDORES (
    Id_prov NUMBER(3),
    Nom_prov VARCHAR2(15),
    Direc_prov VARCHAR2(30)
);
CREATE TABLE AUTORES (
    Id_aut NUMBER(3),
    Nombre VARCHAR2(30)
);  
CREATE TABLE PEDIDOS (
    Id_ped NUMBER(3),
    Fecha DATE,
    Id_prov NUMBER(3)
);
CREATE TABLE PEDIDOS_LIBROS (
    Id_ped NUMBER(3),
    Id_lib NUMBER(3),
    Precio NUMBER(6,2),
    Cant NUMBER(3)
);
CREATE TABLE LIBROS (
    Id_lib NUMBER(3),
    ISBN VARCHAR2(15),
    Titulo VARCHAR2(22),
    Lugar VARCHAR2(12),
    Editor VARCHAR2(12),
    Anio NUMBER(4),
    Pag NUMBER(4),
    Id_aut NUMBER(3)
);
------------- Primary Key ----------------

ALTER TABLE PROVEEDORES 
    ADD CONSTRAINT PK_PROVEEDORES_Id_prov PRIMARY KEY (Id_prov);

ALTER TABLE AUTORES 
    ADD CONSTRAINT PK_AUTORES_Id_aut PRIMARY KEY (Id_aut); 

ALTER TABLE PEDIDOS 
    ADD CONSTRAINT PK_PEDIDOS_Id_ped PRIMARY KEY (Id_ped);

ALTER TABLE PEDIDOS_LIBROS
    ADD CONSTRAINT PK_PEDIDOS_LIBROS PRIMARY KEY (Id_ped, Id_lib);

ALTER TABLE LIBROS
    ADD CONSTRAINT PK_LIBROS_Id_lib PRIMARY KEY (Id_lib);


------------- Foreign Key ------------------

ALTER TABLE PEDIDOS
    ADD CONSTRAINT FK_PEDIDOS_Id_prov FOREIGN KEY (Id_prov)
    REFERENCES PROVEEDORES(Id_prov);

ALTER TABLE LIBROS 
    ADD CONSTRAINT FK_LIBROS_Id_aut FOREIGN KEY (Id_aut)
    REFERENCES AUTORES(Id_aut);

ALTER TABLE PEDIDOS_LIBROS
    ADD CONSTRAINT FK_PEDIDOS_LIBROS_Id_ped FOREIGN KEY (Id_ped)
    REFERENCES PEDIDOS(Id_ped);

ALTER TABLE PEDIDOS_LIBROS
    ADD CONSTRAINT FK_PEDIDOS_LIBROS_Id_lib FOREIGN KEY (Id_lib)
    REFERENCES LIBROS(Id_lib);
------------ Poblar Tablas --------------
INSERT INTO PROVEEDORES VALUES (1, 'Diego Marin', 'Merced, 32. 30043-Murcia');
INSERT INTO PROVEEDORES VALUES (2, 'Blackwells', '16 The Avenue Oxford');
INSERT INTO PROVEEDORES VALUES (3, 'Diaz de Santo', 'Magallanes, 25 28015-Madrid');

INSERT INTO AUTORES VALUES (1, 'Ernesto Rivero');
INSERT INTO AUTORES VALUES (2, 'Vicente Rodriguez');
INSERT INTO AUTORES VALUES (3, 'Carlos Rodero');

INSERT INTO PEDIDOS VALUES (1, TO_DATE('14-SEP-1997', 'DD-MON-YYYY'), 1);
INSERT INTO PEDIDOS VALUES (2, TO_DATE('01-OCT-1997', 'DD-MON-YYYY'), 2);
INSERT INTO PEDIDOS VALUES (3, TO_DATE('04-NOV-1997', 'DD-MON-YYYY'), 3);
INSERT INTO PEDIDOS VALUES (4, TO_DATE('10-DEC-1997', 'DD-MON-YYYY'), 2);

INSERT INTO LIBROS VALUES (1, '84-7897-233-1', 'Disenllo de BD', 'Madrid', 'Paraninfo', 1996, 225, 1);
INSERT INTO LIBROS VALUES (2, '0-82112-462-3', 'Quimica Organica', 'Madrid', 'RA-MA', 1996, 310, 2);
INSERT INTO LIBROS VALUES (3, '0-84131-460-7', 'Alquimia Madrid', 'Madrid', 'RA-MA', 1995, 522, 2);
INSERT INTO LIBROS VALUES (4, '0-69213-517-8', 'Sistemas expertos', 'Murcia', 'U.Murcia', 1997, 257, 1);
INSERT INTO LIBROS VALUES (5, '84-3112-462-1', 'Informatica Documental', 'Oxford', 'Blackwells', 1996, 125, 3);
INSERT INTO LIBROS VALUES (6, '0-71143-526-6', 'Bibliografia', 'Granada', 'U.Granada', 1993, 794, 3);
INSERT INTO LIBROS VALUES (7, '0-63322-891-7', 'Teoria de gestion', 'Barcelona', 'Paraninfo', 1995, 173, 1);

INSERT INTO PEDIDOS_LIBROS VALUES (1, 1, 3200, 2);
INSERT INTO PEDIDOS_LIBROS VALUES (2, 2, 1800, 1);
INSERT INTO PEDIDOS_LIBROS VALUES (2, 3, 2000, 4);
INSERT INTO PEDIDOS_LIBROS VALUES (2, 4, 3299, 20);
INSERT INTO PEDIDOS_LIBROS VALUES (2, 6, 3200, 2);
INSERT INTO PEDIDOS_LIBROS VALUES (3, 5, 4299, 2);
INSERT INTO PEDIDOS_LIBROS VALUES (3, 6, 3800, 3);
INSERT INTO PEDIDOS_LIBROS VALUES (3, 7, 3250, 1);
INSERT INTO PEDIDOS_LIBROS VALUES (3, 2, 1850, 2);
INSERT INTO PEDIDOS_LIBROS VALUES (4, 2, 1900, 2);
INSERT INTO PEDIDOS_LIBROS VALUES (4, 7, 3400, 4);
----------------------------Consultas---------------------------------------
SELECT * FROM PROVEEDORES;
SELECT * FROM AUTORES;
SELECT * FROM PEDIDOS;
SELECT * FROM LIBROS;
SELECT * FROM PEDIDOS_LIBROS;
SELECT * FROM PEDIDOS_LIBROS WHERE Id_ped = 2;
SELECT * FROM PEDIDOS_LIBROS WHERE Id_lib = 2;
SELECT * FROM PEDIDOS_LIBROS WHERE Id_ped = 2 AND Id_lib = 2;
SELECT * FROM PEDIDOS_LIBROS WHERE PRECIO BETWEEN 1000 AND 3000;
SELECT PE.Id_ped, PE.Fecha, PE.Id_prov, Li.Id_lib, ISBN, EDITOR, PAG
from PEDIDOS PE, LIBROS Li, PEDIDOS_LIBROS PL
WHERE PE.Id_ped = PL.Id_ped AND Li.Id_lib = PL.Id_lib; 
---JOIN
SELECT * FROM PEDIDOS_LIBROS JOIN PEDIDOS ON PEDIDOS_LIBROS.Id_ped = PEDIDOS.Id_ped;